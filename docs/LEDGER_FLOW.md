# TekVwarho ProAudit - Ledger Flow & Audit Trail Diagrams

## Document Information

| Attribute | Value |
|-----------|-------|
| Version | 1.0.0 |
| Last Updated | January 2026 |
| Classification | Internal / Audit |
| Compliance | NTAA 2025, IFRS, Nigerian GAAP |

---

## Table of Contents

1. [Overview](#1-overview)
2. [Double-Entry Ledger Flow](#2-double-entry-ledger-flow)
3. [Transaction Processing Pipeline](#3-transaction-processing-pipeline)
4. [Invoice to Cash Flow](#4-invoice-to-cash-flow)
5. [Payroll Processing Flow](#5-payroll-processing-flow)
6. [Tax Compliance Flow](#6-tax-compliance-flow)
7. [Bank Reconciliation Flow](#7-bank-reconciliation-flow)
8. [Audit Trail Architecture](#8-audit-trail-architecture)
9. [Data Integrity & Hash Chain](#9-data-integrity--hash-chain)
10. [NRS E-Invoicing Flow](#10-nrs-e-invoicing-flow)

---

## 1. Overview

This document provides visual representations of how data flows through TekVwarho ProAudit, from initial transaction entry through to financial statements and audit trails.

### Key Principles

1. **Double-Entry**: Every transaction creates balanced debit/credit entries
2. **Immutability**: Audit logs are append-only, never modified
3. **Traceability**: Every GL entry links back to source documents
4. **Real-Time**: Balances update immediately on posting
5. **Compliance**: NTAA 2025 5-year retention with hash verification

---

## 2. Double-Entry Ledger Flow

### 2.1 Fundamental Accounting Equation

```
┌─────────────────────────────────────────────────────────────────────────────────────────┐
│                          ACCOUNTING EQUATION (ALERIE)                                    │
│                                                                                          │
│                    ASSETS = LIABILITIES + EQUITY                                         │
│                                                                                          │
│                         ┌─────────────────────────────────────┐                         │
│                         │        EQUITY                        │                         │
│                         │   ┌─────────────────────────────┐   │                         │
│                         │   │ Capital + Retained Earnings  │   │                         │
│                         │   │ + (Revenue - Expenses)       │   │                         │
│                         │   └─────────────────────────────┘   │                         │
│                         └─────────────────────────────────────┘                         │
│                                                                                          │
│   ┌───────────────────────────────────────────────────────────────────────────────┐    │
│   │                         DEBIT                    CREDIT                        │    │
│   ├───────────────────────────────────────────────────────────────────────────────┤    │
│   │   ASSETS ↑                                      ASSETS ↓                       │    │
│   │   EXPENSES ↑                                    EXPENSES ↓                     │    │
│   │   LIABILITIES ↓                                 LIABILITIES ↑                  │    │
│   │   EQUITY ↓                                      EQUITY ↑                       │    │
│   │   REVENUE ↓                                     REVENUE ↑                      │    │
│   └───────────────────────────────────────────────────────────────────────────────┘    │
│                                                                                          │
│                    *** TOTAL DEBITS MUST EQUAL TOTAL CREDITS ***                        │
└─────────────────────────────────────────────────────────────────────────────────────────┘
```

### 2.2 Journal Entry to General Ledger Flow

```
┌─────────────────────────────────────────────────────────────────────────────────────────┐
│                         JOURNAL ENTRY → GENERAL LEDGER FLOW                              │
└─────────────────────────────────────────────────────────────────────────────────────────┘

                              SOURCE DOCUMENTS
                                    │
    ┌───────────────┬───────────────┼───────────────┬───────────────┐
    │               │               │               │               │
    ▼               ▼               ▼               ▼               ▼
┌───────┐     ┌───────┐      ┌───────────┐   ┌─────────┐    ┌──────────┐
│Invoice│     │Receipt│      │Transaction│   │ Payroll │    │Bank Stmt │
│       │     │       │      │ (Expense) │   │  Run    │    │  Import  │
└───┬───┘     └───┬───┘      └─────┬─────┘   └────┬────┘    └────┬─────┘
    │             │                │              │               │
    └─────────────┴────────────────┴──────────────┴───────────────┘
                                   │
                                   ▼
                    ┌──────────────────────────────┐
                    │      JOURNAL ENTRY           │
                    │ ─────────────────────────    │
                    │ Entry #: JE-2026-001234      │
                    │ Date: 2026-01-15             │
                    │ Type: SALES                  │
                    │ Status: POSTED               │
                    │ Source: Invoice #INV-0001   │
                    │                              │
                    │ Lines:                       │
                    │ ┌────────┬───────┬───────┐  │
                    │ │Account │ Debit │Credit │  │
                    │ ├────────┼───────┼───────┤  │
                    │ │1200 AR │100,000│       │  │
                    │ │4100 Rev│       │ 93,023│  │
                    │ │2300 VAT│       │  6,977│  │
                    │ │TOTAL   │100,000│100,000│  │
                    │ └────────┴───────┴───────┘  │
                    │ *** BALANCED ***            │
                    └──────────────┬───────────────┘
                                   │
                    ┌──────────────┼──────────────┐
                    │              │              │
                    ▼              ▼              ▼
         ┌─────────────────┐ ┌─────────────────┐ ┌─────────────────┐
         │  GL: 1200 A/R   │ │GL: 4100 Revenue │ │GL: 2300 VAT Pay │
         │ ──────────────  │ │ ──────────────  │ │ ──────────────  │
         │ Normal: DEBIT   │ │ Normal: CREDIT  │ │ Normal: CREDIT  │
         │                 │ │                 │ │                 │
         │ Previous: 500K  │ │ Previous: 2.5M  │ │ Previous: 200K  │
         │ + Debit: 100K   │ │ + Credit: 93K   │ │ + Credit: 7K    │
         │ ───────────     │ │ ───────────     │ │ ───────────     │
         │ New Bal: 600K   │ │ New Bal: 2.59M  │ │ New Bal: 207K   │
         └─────────────────┘ └─────────────────┘ └─────────────────┘
                    │              │              │
                    └──────────────┴──────────────┘
                                   │
                                   ▼
                    ┌──────────────────────────────┐
                    │        TRIAL BALANCE         │
                    │ ─────────────────────────    │
                    │ Total Debits:  ₦15,450,000   │
                    │ Total Credits: ₦15,450,000   │
                    │ Difference:    ₦         0   │
                    │ Status: BALANCED ✓           │
                    └──────────────────────────────┘
                                   │
                    ┌──────────────┴──────────────┐
                    │                             │
                    ▼                             ▼
         ┌─────────────────────┐     ┌─────────────────────┐
         │  INCOME STATEMENT   │     │   BALANCE SHEET     │
         │ ─────────────────   │     │ ─────────────────   │
         │ Revenue      2.59M  │     │ Assets        12.5M │
         │ Expenses    (1.80M) │     │ Liabilities    4.2M │
         │ ───────────────     │     │ Equity         8.3M │
         │ Net Income   790K   │     │ ───────────────     │
         │                     │     │ BALANCED ✓          │
         └─────────────────────┘     └─────────────────────┘
```

---

## 3. Transaction Processing Pipeline

### 3.1 Expense Transaction Flow (with WREN Compliance)

```
┌─────────────────────────────────────────────────────────────────────────────────────────┐
│                    EXPENSE TRANSACTION FLOW (WREN MAKER-CHECKER)                         │
│                              NTAA 2025 Compliant                                         │
└─────────────────────────────────────────────────────────────────────────────────────────┘

     USER A (MAKER)                                          USER B (CHECKER)
          │                                                        │
          ▼                                                        │
┌─────────────────────┐                                           │
│  1. CREATE EXPENSE  │                                           │
│  ─────────────────  │                                           │
│  Vendor: ABC Corp   │                                           │
│  Amount: ₦50,000    │                                           │
│  VAT: ₦3,750        │                                           │
│  Category: Supplies │                                           │
│  Receipt: Attached  │                                           │
│                     │                                           │
│  created_by: User A │                                           │
│  wren_status:       │                                           │
│  REVIEW_REQUIRED    │                                           │
└──────────┬──────────┘                                           │
           │                                                      │
           ▼                                                      │
┌─────────────────────┐                                           │
│  2. AUTO CHECKS     │                                           │
│  ─────────────────  │                                           │
│  □ Receipt present? │                                           │
│  □ Vendor TIN valid?│                                           │
│  □ Amount < limit?  │                                           │
│  □ Category valid?  │                                           │
└──────────┬──────────┘                                           │
           │                                                      │
           │    ┌─────────────────────────────────────────────────┘
           │    │
           ▼    ▼
┌─────────────────────────────────────────────┐
│         3. WREN VERIFICATION QUEUE          │
│  ───────────────────────────────────────    │
│  Pending verification by different user     │
│  (Segregation of Duties)                    │
│                                             │
│  ┌───────────────────────────────────────┐  │
│  │ Expense: ₦50,000 to ABC Corp         │  │
│  │ Created by: User A                    │  │
│  │ Status: REVIEW_REQUIRED               │  │
│  │ [VERIFY COMPLIANT] [MARK NON-COMPLIANT]│ │
│  └───────────────────────────────────────┘  │
└────────────────────┬────────────────────────┘
                     │
       ┌─────────────┴─────────────┐
       │                           │
       ▼                           ▼
┌─────────────────┐       ┌─────────────────┐
│ 4a. COMPLIANT   │       │ 4b. NON-COMPLIANT│
│ ─────────────── │       │ ──────────────── │
│ wren_status:    │       │ wren_status:     │
│ COMPLIANT       │       │ NON_COMPLIANT    │
│                 │       │                  │
│ verified_by:    │       │ verified_by:     │
│ User B          │       │ User B           │
│                 │       │                  │
│ verified_at:    │       │ wren_notes:      │
│ 2026-01-15 10:30│       │ "Missing receipt"│
│                 │       │                  │
│ VAT Recoverable:│       │ VAT Recoverable: │
│ YES (₦3,750)    │       │ NO               │
└────────┬────────┘       └────────┬─────────┘
         │                         │
         └───────────┬─────────────┘
                     │
                     ▼
┌─────────────────────────────────────────────┐
│         5. JOURNAL ENTRY GENERATED          │
│  ───────────────────────────────────────    │
│                                             │
│  IF COMPLIANT:                              │
│  ┌────────────────┬──────────┬──────────┐  │
│  │ Account        │ Debit    │ Credit   │  │
│  ├────────────────┼──────────┼──────────┤  │
│  │ 5100 Supplies  │ 50,000   │          │  │
│  │ 1500 Input VAT │  3,750   │          │  │
│  │ 2100 A/Payable │          │ 53,750   │  │
│  └────────────────┴──────────┴──────────┘  │
│                                             │
│  IF NON-COMPLIANT:                          │
│  ┌────────────────┬──────────┬──────────┐  │
│  │ Account        │ Debit    │ Credit   │  │
│  ├────────────────┼──────────┼──────────┤  │
│  │ 5100 Supplies  │ 53,750   │          │  │
│  │ 2100 A/Payable │          │ 53,750   │  │
│  └────────────────┴──────────┴──────────┘  │
│  (VAT not recoverable, expensed instead)   │
└────────────────────┬────────────────────────┘
                     │
                     ▼
┌─────────────────────────────────────────────┐
│         6. AUDIT LOG CREATED                │
│  ───────────────────────────────────────    │
│  action: WREN_VERIFY                        │
│  target: transaction:{id}                   │
│  user_id: User B                            │
│  old_values: {wren_status: "review"}        │
│  new_values: {wren_status: "compliant"}     │
│  ip_address: 192.168.1.100                  │
│  device_fingerprint: abc123...              │
└─────────────────────────────────────────────┘
```

---

## 4. Invoice to Cash Flow

### 4.1 Sales Invoice Lifecycle

```
┌─────────────────────────────────────────────────────────────────────────────────────────┐
│                           INVOICE TO CASH FLOW                                           │
│                        (Sales → AR → Collection → Bank)                                  │
└─────────────────────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────────────────────┐
│ STAGE 1: INVOICE CREATION                                                                │
└─────────────────────────────────────────────────────────────────────────────────────────┘

┌───────────────────────┐
│   DRAFT INVOICE       │
│   ─────────────────   │
│   INV-2026-0001       │
│   Customer: XYZ Ltd   │
│   ┌────────────────┐  │
│   │ Item    │ Amt  │  │
│   ├─────────┼──────┤  │
│   │ Service │100,000│ │
│   │ VAT 7.5%│  7,500│ │
│   │ TOTAL   │107,500│ │
│   └────────────────┘  │
│   Status: DRAFT       │
└───────────┬───────────┘
            │
            │ [Finalize]
            ▼
┌───────────────────────┐
│   PENDING INVOICE     │
│   ─────────────────   │
│   Status: PENDING     │
│   Ready for NRS       │
└───────────┬───────────┘
            │
            │ [Submit to NRS]
            ▼
┌─────────────────────────────────────────────────────────────────────────────────────────┐
│ STAGE 2: NRS E-INVOICING (NTAA 2025)                                                     │
└─────────────────────────────────────────────────────────────────────────────────────────┘

┌───────────────────────┐        ┌───────────────────────┐
│   TekVwarho ProAudit  │───────▶│     NRS GATEWAY       │
│   ─────────────────   │        │   ─────────────────   │
│   POST /nrs/submit    │        │   • Validate TIN      │
│   • Invoice data      │        │   • Generate IRN      │
│   • Seller TIN        │        │   • Sign invoice      │
│   • Buyer TIN         │        │   • Create QR         │
│   • Items/amounts     │        │   • Store record      │
└───────────────────────┘        └───────────┬───────────┘
                                             │
                                             ▼
                                 ┌───────────────────────┐
                                 │   NRS RESPONSE        │
                                 │   ─────────────────   │
                                 │   IRN: NRS123456789   │
                                 │   QR: [encoded data]  │
                                 │   Signature: abc...   │
                                 │   Status: ACCEPTED    │
                                 └───────────┬───────────┘
                                             │
            ┌────────────────────────────────┘
            ▼
┌───────────────────────┐
│   SUBMITTED INVOICE   │
│   ─────────────────   │
│   Status: SUBMITTED   │
│   nrs_irn: NRS123...  │
│   is_nrs_locked: TRUE │
│   buyer_status: PENDING│
│                       │
│   *** 72-HOUR WINDOW ***
│   Buyer can accept/   │
│   reject invoice      │
└───────────┬───────────┘
            │
            │ [72 hours pass OR buyer accepts]
            ▼
┌───────────────────────┐
│   ACCEPTED INVOICE    │
│   ─────────────────   │
│   Status: ACCEPTED    │
│   buyer_status:       │
│   ACCEPTED or         │
│   AUTO_ACCEPTED       │
│                       │
│   *** IMMUTABLE ***   │
│   Cannot edit,        │
│   only Credit Note    │
└───────────┬───────────┘
            │
            ▼
┌─────────────────────────────────────────────────────────────────────────────────────────┐
│ STAGE 3: ACCOUNTING ENTRY (on acceptance)                                                │
└─────────────────────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────┐
│         JOURNAL ENTRY: SALES                │
│  ───────────────────────────────────────    │
│  JE-2026-000456                             │
│  Type: SALES                                │
│  Source: Invoice INV-2026-0001              │
│                                             │
│  ┌────────────────┬──────────┬──────────┐  │
│  │ Account        │ Debit    │ Credit   │  │
│  ├────────────────┼──────────┼──────────┤  │
│  │ 1200 A/R       │ 107,500  │          │  │
│  │ 4100 Revenue   │          │ 100,000  │  │
│  │ 2300 VAT Pay   │          │   7,500  │  │
│  └────────────────┴──────────┴──────────┘  │
│  Status: POSTED                             │
└────────────────────┬────────────────────────┘
                     │
                     ▼
┌─────────────────────────────────────────────────────────────────────────────────────────┐
│ STAGE 4: PAYMENT COLLECTION                                                              │
└─────────────────────────────────────────────────────────────────────────────────────────┘

                     │
                     │ [Customer pays via bank transfer]
                     ▼
┌───────────────────────┐        ┌───────────────────────┐
│   BANK STATEMENT      │        │   PAYMENT RECEIPT     │
│   ─────────────────   │        │   ─────────────────   │
│   Credit: ₦107,500    │───────▶│   REC-2026-0089       │
│   Ref: XYZ-PAY-001    │        │   Invoice: INV-0001   │
│   Date: 2026-01-20    │        │   Amount: ₦107,500    │
└───────────────────────┘        │   Method: Transfer    │
                                 └───────────┬───────────┘
                                             │
                                             ▼
┌─────────────────────────────────────────────┐
│         JOURNAL ENTRY: RECEIPT              │
│  ───────────────────────────────────────    │
│  JE-2026-000512                             │
│  Type: RECEIPT                              │
│  Source: Receipt REC-2026-0089              │
│                                             │
│  ┌────────────────┬──────────┬──────────┐  │
│  │ Account        │ Debit    │ Credit   │  │
│  ├────────────────┼──────────┼──────────┤  │
│  │ 1100 Bank      │ 107,500  │          │  │
│  │ 1200 A/R       │          │ 107,500  │  │
│  └────────────────┴──────────┴──────────┘  │
│  Status: POSTED                             │
└────────────────────┬────────────────────────┘
                     │
                     ▼
┌───────────────────────┐
│   INVOICE: PAID       │
│   ─────────────────   │
│   Status: PAID        │
│   amount_paid: 107,500│
│   A/R Balance: ₦0     │
└───────────────────────┘
```

---

## 5. Payroll Processing Flow

```
┌─────────────────────────────────────────────────────────────────────────────────────────┐
│                            PAYROLL PROCESSING FLOW                                       │
│                    (Nigerian Statutory Deductions: PAYE, Pension, NHF)                  │
└─────────────────────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────────────────────┐
│ STAGE 1: PAYROLL INITIALIZATION                                                          │
└─────────────────────────────────────────────────────────────────────────────────────────┘

┌───────────────────────┐
│   CREATE PAYROLL RUN  │
│   ─────────────────   │
│   Period: Jan 2026    │
│   Employees: 25       │
│   Status: DRAFT       │
└───────────┬───────────┘
            │
            ▼
┌───────────────────────────────────────────────────────────────────────────────────────┐
│                              EMPLOYEE SALARY CALCULATION                               │
│   For each employee:                                                                   │
└───────────────────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────────┐
│  EMPLOYEE: John Doe                                                          │
│  ─────────────────────────────────────────────────────────────────────────  │
│                                                                              │
│  GROSS EARNINGS:                         STATUTORY DEDUCTIONS:               │
│  ┌─────────────────────────────┐        ┌─────────────────────────────┐    │
│  │ Basic Salary     ₦200,000  │        │                             │    │
│  │ Housing (25%)     ₦50,000  │        │ PAYE Calculation:           │    │
│  │ Transport (10%)   ₦20,000  │        │ ─────────────────           │    │
│  │ Meal Allowance    ₦15,000  │        │ Gross Annual: ₦3,420,000    │    │
│  │ Other             ₦ 5,000  │        │ - CRA (20%): ₦684,000       │    │
│  │ ─────────────────────────  │        │ - Pension:   ₦259,200       │    │
│  │ GROSS:          ₦290,000   │        │ Taxable:     ₦2,476,800     │    │
│  └─────────────────────────────┘        │                             │    │
│                                         │ Tax Bands Applied:          │    │
│  PENSION CALCULATION:                   │ ₦300K × 7%  = ₦21,000      │    │
│  ┌─────────────────────────────┐        │ ₦300K × 11% = ₦33,000      │    │
│  │ Pensionable:                │        │ ₦500K × 15% = ₦75,000      │    │
│  │ Basic + Housing + Transport │        │ ₦500K × 19% = ₦95,000      │    │
│  │ = ₦200K + ₦50K + ₦20K      │        │ ₦876.8K×21% = ₦184,128     │    │
│  │ = ₦270,000                  │        │ ─────────────────           │    │
│  │                             │        │ Annual PAYE: ₦408,128      │    │
│  │ Employee (8%): ₦21,600     │        │ Monthly PAYE: ₦34,011      │    │
│  │ Employer (10%): ₦27,000    │        └─────────────────────────────┘    │
│  └─────────────────────────────┘                                           │
│                                         NHF (2.5% of Basic):               │
│                                         ₦200,000 × 2.5% = ₦5,000          │
│                                                                              │
│  ───────────────────────────────────────────────────────────────────────────│
│  SUMMARY:                                                                    │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │ Gross Pay:              ₦290,000                                    │   │
│  │ Less: PAYE              (₦34,011)                                   │   │
│  │ Less: Pension (Emp)     (₦21,600)                                   │   │
│  │ Less: NHF               (₦ 5,000)                                   │   │
│  │ ─────────────────────────────────                                   │   │
│  │ NET PAY:                ₦229,389                                    │   │
│  │                                                                      │   │
│  │ Employer Contributions:                                             │   │
│  │ + Pension (Emp'er)      ₦27,000                                    │   │
│  │ + NSITF (1%)            ₦ 2,900                                    │   │
│  │ + ITF (1%)              ₦ 2,900 (if 5+ employees)                  │   │
│  │ ─────────────────────────────────                                   │   │
│  │ TOTAL EMPLOYER COST:    ₦322,800                                    │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────────────────────┘

            │
            ▼
┌─────────────────────────────────────────────────────────────────────────────────────────┐
│ STAGE 2: APPROVAL & POSTING                                                              │
└─────────────────────────────────────────────────────────────────────────────────────────┘

┌───────────────────────┐        ┌───────────────────────┐
│   PAYROLL APPROVAL    │───────▶│   JOURNAL ENTRIES     │
│   ─────────────────   │        │   ─────────────────   │
│   Prepared by: User A │        │                       │
│   Approved by: User B │        │   SALARIES EXPENSE:   │
│   (Different users)   │        │   Dr. 5200 Salaries   │
│                       │        │      ₦7,250,000       │
│   Status: APPROVED    │        │   Dr. 5210 Pension    │
│                       │        │      ₦675,000 (emp'er)│
│                       │        │                       │
│                       │        │   Cr. 2310 PAYE Pay   │
│                       │        │      ₦850,275         │
│                       │        │   Cr. 2320 Pension    │
│                       │        │      ₦1,215,000       │
│                       │        │   Cr. 2330 NHF Pay    │
│                       │        │      ₦125,000         │
│                       │        │   Cr. 2200 Salaries   │
│                       │        │      Payable ₦5,734K  │
└───────────────────────┘        └───────────┬───────────┘
                                             │
                                             ▼
┌─────────────────────────────────────────────────────────────────────────────────────────┐
│ STAGE 3: PAYMENT & REMITTANCE                                                            │
└─────────────────────────────────────────────────────────────────────────────────────────┘

┌───────────────────────┐
│  BANK PAYMENT FILE    │
│  ─────────────────    │
│  25 employees         │
│  Total: ₦5,734,725    │
│  Format: NIBSS        │
└───────────┬───────────┘
            │
    ┌───────┴───────┐
    │               │
    ▼               ▼
┌───────────┐  ┌───────────────────────────────────────┐
│ SALARIES  │  │ STATUTORY REMITTANCES                 │
│ PAID      │  │ ─────────────────────────────────────│
│           │  │                                       │
│ Dr. 2200  │  │ PAYE → State IRS        ₦850,275    │
│ Cr. 1100  │  │ Pension → PFA           ₦1,215,000  │
│           │  │ NHF → FMBN              ₦125,000    │
└───────────┘  │ NSITF → NSITF           ₦72,500     │
               │ ITF → ITF               ₦72,500     │
               │ ─────────────────────────────────────│
               │ Due by: 10th of following month      │
               └───────────────────────────────────────┘
```

---

## 6. Tax Compliance Flow

```
┌─────────────────────────────────────────────────────────────────────────────────────────┐
│                             VAT COMPLIANCE FLOW                                          │
│                      (Monthly Filing to FIRS - Due 21st)                                │
└─────────────────────────────────────────────────────────────────────────────────────────┘

                         THROUGHOUT THE MONTH
                                 │
    ┌────────────────────────────┼────────────────────────────┐
    │                            │                            │
    ▼                            ▼                            ▼
┌───────────┐            ┌───────────────┐            ┌───────────────┐
│  SALES    │            │  PURCHASES    │            │  BANK CHARGES │
│  INVOICES │            │  (Expenses)   │            │  (with VAT)   │
└─────┬─────┘            └───────┬───────┘            └───────┬───────┘
      │                          │                            │
      ▼                          ▼                            ▼
┌───────────┐            ┌───────────────┐            ┌───────────────┐
│OUTPUT VAT │            │  INPUT VAT    │            │  INPUT VAT    │
│ @ 7.5%    │            │  (if WREN     │            │  (Bank fees)  │
│           │            │   compliant)  │            │               │
│ ₦750,000  │            │  ₦450,000     │            │  ₦15,000      │
└─────┬─────┘            └───────┬───────┘            └───────┬───────┘
      │                          │                            │
      └──────────────────────────┴────────────────────────────┘
                                 │
                                 ▼
┌─────────────────────────────────────────────────────────────────────────────┐
│                        VAT RECORD (Monthly)                                  │
│  ─────────────────────────────────────────────────────────────────────────  │
│  Period: January 2026                                                        │
│                                                                              │
│  OUTPUT VAT COLLECTED:                                                       │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │ Taxable Sales (Standard Rate):     ₦10,000,000                      │   │
│  │ VAT @ 7.5%:                        ₦   750,000                      │   │
│  │ Zero-Rated Sales:                  ₦ 2,000,000                      │   │
│  │ Exempt Sales:                      ₦   500,000                      │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
│                                                                              │
│  INPUT VAT PAID:                                                            │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │ WREN Compliant Purchases:          ₦ 6,000,000                      │   │
│  │ Input VAT (Recoverable):           ₦   450,000                      │   │
│  │                                                                      │   │
│  │ Non-Compliant Purchases:           ₦   800,000                      │   │
│  │ Input VAT (NOT Recoverable):       ₦    60,000  ← Expensed         │   │
│  │                                                                      │   │
│  │ Bank Charges VAT:                  ₦    15,000  ← Recoverable      │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
│                                                                              │
│  CALCULATION:                                                               │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │ Output VAT:                        ₦   750,000                      │   │
│  │ Less: Recoverable Input VAT:       (₦  465,000)                     │   │
│  │ ─────────────────────────────────────────────                       │   │
│  │ VAT PAYABLE:                       ₦   285,000                      │   │
│  │                                                                      │   │
│  │ Due Date: 21st February 2026                                        │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────────────────────┘
                                 │
                                 ▼
┌─────────────────────────────────────────────────────────────────────────────┐
│                           FIRS VAT RETURN                                    │
│  ─────────────────────────────────────────────────────────────────────────  │
│  Form: VAT 002 (Monthly Return)                                             │
│                                                                              │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │ Section A: Output VAT                                               │   │
│  │   Standard Rated Supplies:          ₦10,000,000                     │   │
│  │   Output VAT Due:                   ₦   750,000                     │   │
│  │                                                                      │   │
│  │ Section B: Input VAT                                                │   │
│  │   Allowable Input Tax:              ₦   465,000                     │   │
│  │                                                                      │   │
│  │ Section C: Tax Payable                                              │   │
│  │   Net VAT Payable:                  ₦   285,000                     │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
│                                                                              │
│  File via: TaxProMax / FIRS Portal                                          │
│  Payment: Bank / Remita                                                     │
└─────────────────────────────────────────────────────────────────────────────┘
                                 │
                                 ▼
┌─────────────────────────────────────────────────────────────────────────────┐
│                        JOURNAL ENTRY: VAT PAYMENT                            │
│  ─────────────────────────────────────────────────────────────────────────  │
│  ┌────────────────────────────┬──────────────┬──────────────┐              │
│  │ Account                    │ Debit        │ Credit       │              │
│  ├────────────────────────────┼──────────────┼──────────────┤              │
│  │ 2300 VAT Payable           │ ₦285,000     │              │              │
│  │ 1100 Bank                  │              │ ₦285,000     │              │
│  └────────────────────────────┴──────────────┴──────────────┘              │
│  Reference: FIRS-VAT-2026-01-XYZ                                           │
└─────────────────────────────────────────────────────────────────────────────┘
```

---

## 7. Bank Reconciliation Flow

```
┌─────────────────────────────────────────────────────────────────────────────────────────┐
│                          BANK RECONCILIATION FLOW                                        │
│                    (Multi-Channel Import → Auto-Match → Reconcile)                      │
└─────────────────────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────────────────────┐
│ STAGE 1: STATEMENT IMPORT                                                                │
└─────────────────────────────────────────────────────────────────────────────────────────┘

     ┌──────────────────────────────────────────────────────────────────────────────┐
     │                         IMPORT CHANNELS                                       │
     └──────────────────────────────────────────────────────────────────────────────┘
           │              │              │              │              │
           ▼              ▼              ▼              ▼              ▼
     ┌──────────┐  ┌──────────┐  ┌──────────┐  ┌──────────┐  ┌──────────┐
     │ Mono API │  │ Okra API │  │ CSV/Excel│  │  MT940   │  │ PDF OCR  │
     │          │  │          │  │  Upload  │  │  Upload  │  │          │
     └────┬─────┘  └────┬─────┘  └────┬─────┘  └────┬─────┘  └────┬─────┘
          │             │             │             │             │
          └─────────────┴─────────────┴─────────────┴─────────────┘
                                      │
                                      ▼
     ┌─────────────────────────────────────────────────────────────────────────────┐
     │                    BANK STATEMENT LINES                                      │
     │  ─────────────────────────────────────────────────────────────────────────  │
     │  ┌────────┬───────────────────────────────┬──────────┬──────────┬────────┐ │
     │  │ Date   │ Description                   │ Debit    │ Credit   │ Status │ │
     │  ├────────┼───────────────────────────────┼──────────┼──────────┼────────┤ │
     │  │ Jan 05 │ XYZ LTD/NIP/REF123           │          │ 107,500  │UNMATCHED│ │
     │  │ Jan 06 │ POS/ABC STORES/LAGOS         │   45,000 │          │UNMATCHED│ │
     │  │ Jan 06 │ EMTL                         │       50 │          │UNMATCHED│ │
     │  │ Jan 07 │ SMS ALERT CHARGE             │      500 │          │UNMATCHED│ │
     │  │ Jan 07 │ VAT ON SMS                   │       38 │          │UNMATCHED│ │
     │  │ Jan 10 │ PAYROLL/EMPLOYEE SALARIES    │5,734,725 │          │UNMATCHED│ │
     │  │ ...    │ ...                          │ ...      │ ...      │ ...    │ │
     │  └────────┴───────────────────────────────┴──────────┴──────────┴────────┘ │
     └─────────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────────────────────┐
│ STAGE 2: AUTO-MATCHING ENGINE                                                            │
└─────────────────────────────────────────────────────────────────────────────────────────┘

                                      │
                                      ▼
     ┌─────────────────────────────────────────────────────────────────────────────┐
     │                       MATCHING ALGORITHMS                                    │
     │  ─────────────────────────────────────────────────────────────────────────  │
     │                                                                              │
     │  1. EXACT MATCH                                                             │
     │     ├─ Amount + Date + Reference → 95% confidence                          │
     │     └─ "XYZ LTD/REF123" matches Invoice INV-0001 paid by XYZ Ltd          │
     │                                                                              │
     │  2. FUZZY MATCH                                                             │
     │     ├─ Amount ±₦10 + Date ±3 days → 85% confidence                        │
     │     └─ "POS/ABC STORES" matches Expense "ABC Store purchase"               │
     │                                                                              │
     │  3. RULE-BASED MATCH                                                        │
     │     ├─ Description contains "EMTL" → Auto-categorize as EMTL charge        │
     │     ├─ Description contains "SMS ALERT" → Bank charge (auto-post)          │
     │     └─ Description contains "PAYROLL" → Match to Payroll Run               │
     │                                                                              │
     │  4. ONE-TO-MANY MATCH                                                       │
     │     └─ Single deposit matches multiple invoices                            │
     │                                                                              │
     │  5. MANY-TO-ONE MATCH                                                       │
     │     └─ Multiple deposits match single invoice (installments)               │
     │                                                                              │
     └─────────────────────────────────────────────────────────────────────────────┘
                                      │
                                      ▼
     ┌─────────────────────────────────────────────────────────────────────────────┐
     │                       MATCH RESULTS                                          │
     │  ─────────────────────────────────────────────────────────────────────────  │
     │  ┌────────┬───────────────────────────────┬──────────┬──────────┬────────┐ │
     │  │ Date   │ Description                   │ Amount   │ Match    │Confidence│
     │  ├────────┼───────────────────────────────┼──────────┼──────────┼────────┤ │
     │  │ Jan 05 │ XYZ LTD/NIP/REF123           │ 107,500  │INV-0001  │  98%   │ │
     │  │ Jan 06 │ POS/ABC STORES/LAGOS         │  45,000  │EXP-0023  │  87%   │ │
     │  │ Jan 06 │ EMTL                         │      50  │AUTO-POST │ 100%   │ │
     │  │ Jan 07 │ SMS ALERT CHARGE             │     500  │AUTO-POST │ 100%   │ │
     │  │ Jan 10 │ PAYROLL/EMPLOYEE SALARIES    │5,734,725 │PAY-0001  │  95%   │ │
     │  └────────┴───────────────────────────────┴──────────┴──────────┴────────┘ │
     └─────────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────────────────────┐
│ STAGE 3: RECONCILIATION                                                                  │
└─────────────────────────────────────────────────────────────────────────────────────────┘

                                      │
                                      ▼
     ┌─────────────────────────────────────────────────────────────────────────────┐
     │                    RECONCILIATION SUMMARY                                    │
     │  ─────────────────────────────────────────────────────────────────────────  │
     │  Period: January 2026                                                       │
     │  Account: GTBank Current ****1234                                           │
     │                                                                              │
     │  ┌─────────────────────────────────────────────────────────────────────┐   │
     │  │ BOOK BALANCE (Per GL)                           ₦ 8,450,000         │   │
     │  │                                                                      │   │
     │  │ Add: Deposits in Transit                                            │   │
     │  │   • Customer payment (Jan 31)                   ₦   150,000         │   │
     │  │                                                 ─────────────        │   │
     │  │                                                 ₦ 8,600,000         │   │
     │  │                                                                      │   │
     │  │ Less: Outstanding Checks                                            │   │
     │  │   • Vendor payment #1234                        (₦   75,000)        │   │
     │  │   • Rent payment                                (₦  200,000)        │   │
     │  │                                                 ─────────────        │   │
     │  │ ADJUSTED BOOK BALANCE                           ₦ 8,325,000         │   │
     │  └─────────────────────────────────────────────────────────────────────┘   │
     │                                                                              │
     │  ┌─────────────────────────────────────────────────────────────────────┐   │
     │  │ BANK BALANCE (Per Statement)                    ₦ 8,325,588         │   │
     │  │                                                                      │   │
     │  │ Add: Bank Errors                                                    │   │
     │  │   • None                                        ₦         0         │   │
     │  │                                                                      │   │
     │  │ Less: Book Errors                                                   │   │
     │  │   • Unrecorded bank charge                      (₦      588)        │   │
     │  │                                                 ─────────────        │   │
     │  │ ADJUSTED BANK BALANCE                           ₦ 8,325,000         │   │
     │  └─────────────────────────────────────────────────────────────────────┘   │
     │                                                                              │
     │  ┌─────────────────────────────────────────────────────────────────────┐   │
     │  │ DIFFERENCE:                                     ₦         0  ✓      │   │
     │  │ STATUS: RECONCILED                                                  │   │
     │  └─────────────────────────────────────────────────────────────────────┘   │
     └─────────────────────────────────────────────────────────────────────────────┘
```

---

## 8. Audit Trail Architecture

```
┌─────────────────────────────────────────────────────────────────────────────────────────┐
│                           AUDIT TRAIL ARCHITECTURE                                       │
│                         (NTAA 2025 - 5 Year Retention)                                  │
└─────────────────────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────────────────────┐
│                              AUDIT EVENT SOURCES                                         │
└─────────────────────────────────────────────────────────────────────────────────────────┘

┌──────────────┐ ┌──────────────┐ ┌──────────────┐ ┌──────────────┐ ┌──────────────┐
│    USER      │ │   SYSTEM     │ │  EXTERNAL    │ │   SCHEDULED  │ │   API        │
│   ACTIONS    │ │   EVENTS     │ │   SYSTEMS    │ │    JOBS      │ │   CALLS      │
├──────────────┤ ├──────────────┤ ├──────────────┤ ├──────────────┤ ├──────────────┤
│ • Login      │ │ • Auto-post  │ │ • NRS submit │ │ • Depreciation│ │ • Mono sync │
│ • Create     │ │ • Period close│ │ • NRS response│ │ • Period close│ │ • Webhook   │
│ • Update     │ │ • Balance calc│ │ • Bank API   │ │ • Report gen │ │ • Integration│
│ • Delete     │ │ • Tax calc   │ │ • Payment    │ │ • Backup     │ │              │
│ • View       │ │              │ │              │ │              │ │              │
│ • Export     │ │              │ │              │ │              │ │              │
└──────┬───────┘ └──────┬───────┘ └──────┬───────┘ └──────┬───────┘ └──────┬───────┘
       │                │                │                │                │
       └────────────────┴────────────────┴────────────────┴────────────────┘
                                         │
                                         ▼
┌─────────────────────────────────────────────────────────────────────────────────────────┐
│                              AUDIT LOG SERVICE                                           │
│  ─────────────────────────────────────────────────────────────────────────────────────  │
│                                                                                          │
│  ┌──────────────────────────────────────────────────────────────────────────────────┐  │
│  │                            EVENT ENRICHMENT                                       │  │
│  │  ─────────────────────────────────────────────────────────────────────────────   │  │
│  │                                                                                   │  │
│  │  • Capture IP Address (from request)                                             │  │
│  │  • Extract User Agent                                                            │  │
│  │  • Generate Device Fingerprint                                                   │  │
│  │  • Capture Session ID                                                            │  │
│  │  • Compute old_values vs new_values diff                                        │  │
│  │  • Timestamp with timezone                                                       │  │
│  │                                                                                   │  │
│  └──────────────────────────────────────────────────────────────────────────────────┘  │
│                                         │                                               │
│                                         ▼                                               │
│  ┌──────────────────────────────────────────────────────────────────────────────────┐  │
│  │                            WRITE TO AUDIT_LOG                                     │  │
│  │  ─────────────────────────────────────────────────────────────────────────────   │  │
│  │                                                                                   │  │
│  │  INSERT INTO audit_log (                                                         │  │
│  │      id, entity_id, user_id, action,                                            │  │
│  │      target_entity_type, target_entity_id,                                      │  │
│  │      description, old_values, new_values, changes,                              │  │
│  │      ip_address, user_agent, device_fingerprint, session_id,                    │  │
│  │      nrs_irn, nrs_response, created_at                                          │  │
│  │  ) VALUES (...);                                                                 │  │
│  │                                                                                   │  │
│  │  *** APPEND-ONLY - NO UPDATE/DELETE ALLOWED ***                                 │  │
│  │                                                                                   │  │
│  └──────────────────────────────────────────────────────────────────────────────────┘  │
│                                                                                          │
└─────────────────────────────────────────────────────────────────────────────────────────┘
                                         │
                                         ▼
┌─────────────────────────────────────────────────────────────────────────────────────────┐
│                              AUDIT LOG STRUCTURE                                         │
│  ─────────────────────────────────────────────────────────────────────────────────────  │
│                                                                                          │
│  ┌──────────────────────────────────────────────────────────────────────────────────┐  │
│  │ {                                                                                 │  │
│  │   "id": "550e8400-e29b-41d4-a716-446655440000",                                  │  │
│  │   "entity_id": "123e4567-e89b-12d3-a456-426614174000",                           │  │
│  │   "user_id": "789e0123-e89b-12d3-a456-426614174000",                             │  │
│  │   "action": "UPDATE",                                                            │  │
│  │   "target_entity_type": "invoice",                                               │  │
│  │   "target_entity_id": "INV-2026-0001",                                           │  │
│  │   "description": "Invoice status changed to PAID",                               │  │
│  │                                                                                   │  │
│  │   "old_values": {                                                                │  │
│  │     "status": "ACCEPTED",                                                        │  │
│  │     "amount_paid": 0                                                             │  │
│  │   },                                                                              │  │
│  │   "new_values": {                                                                │  │
│  │     "status": "PAID",                                                            │  │
│  │     "amount_paid": 107500                                                        │  │
│  │   },                                                                              │  │
│  │   "changes": {                                                                   │  │
│  │     "status": ["ACCEPTED", "PAID"],                                              │  │
│  │     "amount_paid": [0, 107500]                                                   │  │
│  │   },                                                                              │  │
│  │                                                                                   │  │
│  │   "ip_address": "192.168.1.100",                                                 │  │
│  │   "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64)...",                 │  │
│  │   "device_fingerprint": "abc123def456...",                                       │  │
│  │   "session_id": "sess_xyz789...",                                                │  │
│  │                                                                                   │  │
│  │   "nrs_irn": null,                                                               │  │
│  │   "nrs_response": null,                                                          │  │
│  │                                                                                   │  │
│  │   "created_at": "2026-01-20T14:30:00+01:00"                                      │  │
│  │ }                                                                                 │  │
│  └──────────────────────────────────────────────────────────────────────────────────┘  │
│                                                                                          │
└─────────────────────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────────────────────┐
│                              AUDIT QUERIES & REPORTS                                     │
└─────────────────────────────────────────────────────────────────────────────────────────┘

┌──────────────────┐  ┌──────────────────┐  ┌──────────────────┐  ┌──────────────────┐
│ Activity by User │  │ Activity by Date │  │ Activity by Type │  │ NRS Submissions  │
├──────────────────┤  ├──────────────────┤  ├──────────────────┤  ├──────────────────┤
│ User A: 150      │  │ Jan 15: 45       │  │ CREATE: 200      │  │ Total: 1,234     │
│ User B: 89       │  │ Jan 16: 52       │  │ UPDATE: 450      │  │ Accepted: 1,200  │
│ User C: 234      │  │ Jan 17: 38       │  │ DELETE: 12       │  │ Rejected: 34     │
│ System: 1,200    │  │ Jan 18: 67       │  │ VIEW: 3,000      │  │ Pending: 0       │
└──────────────────┘  └──────────────────┘  └──────────────────┘  └──────────────────┘
```

---

## 9. Data Integrity & Hash Chain

```
┌─────────────────────────────────────────────────────────────────────────────────────────┐
│                         DATA INTEGRITY & HASH CHAIN                                      │
│                        (Tamper-Evident Audit Trail)                                     │
└─────────────────────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────────────────────┐
│                         INDIVIDUAL RECORD HASHING                                        │
└─────────────────────────────────────────────────────────────────────────────────────────┘

┌───────────────────────────────────────────────────────────────────────────────────────┐
│                              AUDIT RECORD                                              │
│  ─────────────────────────────────────────────────────────────────────────────────    │
│                                                                                        │
│  Input Data:                                                                          │
│  ┌────────────────────────────────────────────────────────────────────────────────┐  │
│  │ {                                                                               │  │
│  │   "id": "550e8400-e29b-41d4-a716-446655440000",                                │  │
│  │   "entity_id": "123e4567-e89b-12d3-a456-426614174000",                         │  │
│  │   "action": "NRS_SUBMIT",                                                       │  │
│  │   "target": "invoice:INV-2026-0001",                                           │  │
│  │   "timestamp": "2026-01-15T10:30:00+01:00"                                     │  │
│  │ }                                                                               │  │
│  └────────────────────────────────────────────────────────────────────────────────┘  │
│                                         │                                             │
│                                         ▼                                             │
│                              ┌─────────────────────┐                                  │
│                              │   SHA-256 HASH      │                                  │
│                              └──────────┬──────────┘                                  │
│                                         │                                             │
│                                         ▼                                             │
│  ┌────────────────────────────────────────────────────────────────────────────────┐  │
│  │ integrity_hash: "a7b9c3d4e5f6789012345678901234567890abcdef1234567890abcdef12" │  │
│  └────────────────────────────────────────────────────────────────────────────────┘  │
│                                                                                        │
└───────────────────────────────────────────────────────────────────────────────────────┘


┌─────────────────────────────────────────────────────────────────────────────────────────┐
│                         FISCAL YEAR CHAIN HASH                                           │
└─────────────────────────────────────────────────────────────────────────────────────────┘

┌───────────────────────────────────────────────────────────────────────────────────────┐
│                         CHAIN HASH CONSTRUCTION                                        │
│  ─────────────────────────────────────────────────────────────────────────────────    │
│                                                                                        │
│  For each audit record in the fiscal year (ordered by timestamp):                     │
│                                                                                        │
│  ┌─────────────────┐     ┌─────────────────┐     ┌─────────────────┐                 │
│  │ Record 1        │     │ Record 2        │     │ Record 3        │                 │
│  │ Jan 1, 09:00    │────▶│ Jan 1, 09:15    │────▶│ Jan 1, 09:30    │────▶ ...       │
│  │                 │     │                 │     │                 │                 │
│  │ Hash: abc123... │     │ Hash: def456... │     │ Hash: ghi789... │                 │
│  └─────────────────┘     └─────────────────┘     └─────────────────┘                 │
│           │                       │                       │                           │
│           └───────────────────────┴───────────────────────┘                           │
│                                   │                                                   │
│                                   ▼                                                   │
│                    ┌─────────────────────────────────────┐                           │
│                    │ Chain Elements:                      │                           │
│                    │ ["abc123...", "def456...", "ghi789.."│                           │
│                    │  ... all record hashes for FY2026]  │                           │
│                    └─────────────────────────────────────┘                           │
│                                   │                                                   │
│                                   ▼                                                   │
│                    ┌─────────────────────────────────────┐                           │
│                    │ Join with delimiter: "|"            │                           │
│                    │ "abc123...|def456...|ghi789...|..." │                           │
│                    └─────────────────────────────────────┘                           │
│                                   │                                                   │
│                                   ▼                                                   │
│                    ┌─────────────────────────────────────┐                           │
│                    │ Final SHA-256 Hash:                 │                           │
│                    │ "xyz789...final_chain_hash..."      │                           │
│                    └─────────────────────────────────────┘                           │
│                                                                                        │
└───────────────────────────────────────────────────────────────────────────────────────┘


┌─────────────────────────────────────────────────────────────────────────────────────────┐
│                         INTEGRITY VERIFICATION                                           │
└─────────────────────────────────────────────────────────────────────────────────────────┘

┌───────────────────────────────────────────────────────────────────────────────────────┐
│                                                                                        │
│  ┌─────────────────────────────────────────────────────────────────────────────────┐ │
│  │                    SINGLE RECORD VERIFICATION                                    │ │
│  │  ─────────────────────────────────────────────────────────────────────────────  │ │
│  │                                                                                  │ │
│  │  1. Retrieve record from database                                               │ │
│  │  2. Extract verification fields (id, entity_id, action, target, timestamp)      │ │
│  │  3. Compute SHA-256 hash                                                        │ │
│  │  4. Compare with stored integrity_hash                                          │ │
│  │                                                                                  │ │
│  │  Result:                                                                        │ │
│  │  ┌─────────────────────────────────────────────────────────────────────────┐   │ │
│  │  │ {                                                                        │   │ │
│  │  │   "verified": true,                                                      │   │ │
│  │  │   "record_id": "550e8400-e29b-41d4-a716-446655440000",                  │   │ │
│  │  │   "integrity_hash": "a7b9c3d4e5f6...",                                  │   │ │
│  │  │   "verification_time": "2026-01-21T15:00:00+01:00"                      │   │ │
│  │  │ }                                                                        │   │ │
│  │  └─────────────────────────────────────────────────────────────────────────┘   │ │
│  └─────────────────────────────────────────────────────────────────────────────────┘ │
│                                                                                        │
│  ┌─────────────────────────────────────────────────────────────────────────────────┐ │
│  │                    FISCAL YEAR VERIFICATION                                      │ │
│  │  ─────────────────────────────────────────────────────────────────────────────  │ │
│  │                                                                                  │ │
│  │  1. Retrieve all records for fiscal year (ordered by timestamp)                 │ │
│  │  2. Compute hash for each record                                                │ │
│  │  3. Build chain hash                                                            │ │
│  │  4. Compare with stored/expected chain hash                                     │ │
│  │                                                                                  │ │
│  │  Result:                                                                        │ │
│  │  ┌─────────────────────────────────────────────────────────────────────────┐   │ │
│  │  │ {                                                                        │   │ │
│  │  │   "verified": true,                                                      │   │ │
│  │  │   "fiscal_year": 2026,                                                   │   │ │
│  │  │   "record_count": 125000,                                                │   │ │
│  │  │   "chain_hash": "xyz789...final_chain_hash...",                         │   │ │
│  │  │   "first_record": "2026-01-01T00:00:00+01:00",                          │   │ │
│  │  │   "last_record": "2026-01-21T14:59:59+01:00",                           │   │ │
│  │  │   "verification_time": "2026-01-21T15:00:00+01:00"                      │   │ │
│  │  │ }                                                                        │   │ │
│  │  └─────────────────────────────────────────────────────────────────────────┘   │ │
│  └─────────────────────────────────────────────────────────────────────────────────┘ │
│                                                                                        │
│  *** IF ANY RECORD IS MODIFIED, DELETED, OR INSERTED ***                              │
│  *** THE CHAIN HASH WILL NOT MATCH - TAMPERING DETECTED ***                          │
│                                                                                        │
└───────────────────────────────────────────────────────────────────────────────────────┘
```

---

## 10. NRS E-Invoicing Flow

```
┌─────────────────────────────────────────────────────────────────────────────────────────┐
│                          NRS E-INVOICING FLOW                                            │
│                        (NTAA 2025 - 72-Hour Legal Lock)                                 │
└─────────────────────────────────────────────────────────────────────────────────────────┘

┌───────────────────────────────────────────────────────────────────────────────────────┐
│                                                                                        │
│  SELLER                          NRS                           BUYER                  │
│  (TekVwarho ProAudit)            (FIRS)                        (Customer)             │
│                                                                                        │
│  ┌─────────────────┐                                                                  │
│  │ 1. CREATE       │                                                                  │
│  │    INVOICE      │                                                                  │
│  │                 │                                                                  │
│  │ INV-2026-0001   │                                                                  │
│  │ Status: DRAFT   │                                                                  │
│  └────────┬────────┘                                                                  │
│           │                                                                            │
│           │ [Finalize]                                                                │
│           ▼                                                                            │
│  ┌─────────────────┐                                                                  │
│  │ 2. SUBMIT       │         ┌─────────────────┐                                      │
│  │    TO NRS       │────────▶│ 3. VALIDATE     │                                      │
│  │                 │         │    & PROCESS    │                                      │
│  │ POST /nrs/submit│         │                 │                                      │
│  │ • Invoice data  │         │ • Validate TIN  │                                      │
│  │ • Seller TIN    │         │ • Check amounts │                                      │
│  │ • Buyer TIN     │         │ • Generate IRN  │                                      │
│  │ • Items         │         │ • Sign invoice  │                                      │
│  │ • VAT           │         │ • Create QR     │                                      │
│  └─────────────────┘         └────────┬────────┘                                      │
│                                       │                                                │
│                                       ▼                                                │
│  ┌─────────────────┐         ┌─────────────────┐                                      │
│  │ 4. RECEIVE      │◀────────│ NRS RESPONSE    │                                      │
│  │    RESPONSE     │         │                 │                                      │
│  │                 │         │ IRN: NRS123456  │                                      │
│  │ Update invoice: │         │ QR: [data]      │                                      │
│  │ • nrs_irn       │         │ Signature: xyz  │                                      │
│  │ • nrs_response  │         │ Status: ACCEPTED│                                      │
│  │ • is_nrs_locked │         └─────────────────┘                                      │
│  │   = TRUE        │                                                                  │
│  └────────┬────────┘                                                                  │
│           │                                                                            │
│           │                                       ┌─────────────────┐                 │
│           │                                       │ 5. NOTIFY       │                 │
│           │                          ────────────▶│    BUYER        │                 │
│           │                                       │                 │                 │
│           │                                       │ "Invoice        │                 │
│           │                                       │  INV-2026-0001  │                 │
│           │                                       │  received from  │                 │
│           │                                       │  Seller Ltd"    │                 │
│           │                                       └────────┬────────┘                 │
│           │                                                │                           │
│           │                                                │                           │
│           │              ┌─────────────────────────────────┘                           │
│           │              │                                                             │
│           │              ▼                                                             │
│           │     ┌─────────────────────────────────────────────────────────────┐       │
│           │     │                    72-HOUR WINDOW                            │       │
│           │     │  ─────────────────────────────────────────────────────────  │       │
│           │     │                                                              │       │
│           │     │  Buyer can:                                                  │       │
│           │     │  • ACCEPT invoice → Immediate confirmation                  │       │
│           │     │  • REJECT invoice → With valid reason                       │       │
│           │     │  • NO ACTION → Auto-accepted after 72 hours                 │       │
│           │     │                                                              │       │
│           │     │  Seller CANNOT:                                              │       │
│           │     │  • Edit invoice                                              │       │
│           │     │  • Delete invoice                                            │       │
│           │     │  • Cancel NRS submission (except Owner within 72hrs)        │       │
│           │     │                                                              │       │
│           │     └─────────────────────────────────────────────────────────────┘       │
│           │                          │                                                 │
│           │              ┌───────────┴───────────┐                                    │
│           │              │                       │                                    │
│           │              ▼                       ▼                                    │
│           │     ┌─────────────────┐     ┌─────────────────┐                          │
│           │     │ 6a. BUYER       │     │ 6b. 72 HOURS    │                          │
│           │     │     ACCEPTS     │     │     EXPIRE      │                          │
│           │     │                 │     │                 │                          │
│           │     │ buyer_status:   │     │ buyer_status:   │                          │
│           │     │ ACCEPTED        │     │ AUTO_ACCEPTED   │                          │
│           │     └────────┬────────┘     └────────┬────────┘                          │
│           │              │                       │                                    │
│           │              └───────────┬───────────┘                                    │
│           │                          │                                                 │
│           ▼                          ▼                                                 │
│  ┌───────────────────────────────────────────────────────────────────────────────┐   │
│  │                           INVOICE FINALIZED                                    │   │
│  │  ─────────────────────────────────────────────────────────────────────────    │   │
│  │                                                                                │   │
│  │  *** IMMUTABLE - CANNOT BE EDITED ***                                         │   │
│  │                                                                                │   │
│  │  To make changes:                                                             │   │
│  │  • Issue CREDIT NOTE referencing original invoice                            │   │
│  │  • Credit note also submitted to NRS                                         │   │
│  │  • Original invoice remains unchanged                                        │   │
│  │                                                                                │   │
│  └───────────────────────────────────────────────────────────────────────────────┘   │
│                                                                                        │
└───────────────────────────────────────────────────────────────────────────────────────┘


┌───────────────────────────────────────────────────────────────────────────────────────┐
│                          CREDIT NOTE FLOW                                              │
└───────────────────────────────────────────────────────────────────────────────────────┘

┌─────────────────┐         ┌─────────────────┐         ┌─────────────────┐
│ ORIGINAL        │         │ CREDIT NOTE     │         │ NRS             │
│ INVOICE         │────────▶│ CREATED         │────────▶│ SUBMISSION      │
│                 │         │                 │         │                 │
│ INV-2026-0001   │         │ CN-2026-0001    │         │ IRN: NRS-CN-001 │
│ Amount: 107,500 │         │ Ref: INV-0001   │         │ Type: CREDIT    │
│ Status: ACCEPTED│         │ Amount: -10,750 │         │ Status: ACCEPTED│
│ (unchanged)     │         │ Reason: Discount│         │                 │
└─────────────────┘         └─────────────────┘         └─────────────────┘
         │                           │                           │
         │                           │                           │
         └───────────────────────────┴───────────────────────────┘
                                     │
                                     ▼
                          ┌─────────────────────────────┐
                          │ NET EFFECT:                 │
                          │ Original:    ₦107,500       │
                          │ Credit Note: (₦10,750)      │
                          │ ───────────────────────     │
                          │ Net:         ₦ 96,750       │
                          │                             │
                          │ Both documents preserved    │
                          │ Full audit trail maintained │
                          └─────────────────────────────┘
```

---

## Document History

| Version | Date | Author | Changes |
|---------|------|--------|---------|
| 1.0.0 | January 2026 | TekVwarho LTD | Initial release |

---

*Document generated for TekVwarho ProAudit v1.0*
*For internal use, auditor review, and regulatory compliance*
