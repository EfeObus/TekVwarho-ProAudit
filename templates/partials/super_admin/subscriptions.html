<!-- Subscription & Billing Section -->
<!-- Answers: What's the revenue? Who's paying? Who's at risk? -->

<!-- Revenue Overview Cards -->
<div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
    <div class="metric-card highlight">
        <div class="flex items-start justify-between">
            <div>
                <p class="metric-label">Monthly Recurring Revenue</p>
                <p class="metric-value">₦{{ "{:,.0f}".format(dashboard.platform_revenue.mrr if dashboard.platform_revenue else 0) }}</p>
                <div class="metric-trend up mt-2">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"/></svg>
                    <span>+8.3% from last month</span>
                </div>
            </div>
            <div class="w-12 h-12 bg-white/20 rounded-xl flex items-center justify-center">
                <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
            </div>
        </div>
    </div>
    <div class="metric-card">
        <p class="metric-label">Annual Recurring Revenue</p>
        <p class="metric-value text-ng-green">₦{{ "{:,.0f}".format(dashboard.platform_revenue.arr if dashboard.platform_revenue else 0) }}</p>
        <p class="text-sm text-gray-500 mt-2">Projected from MRR x 12</p>
    </div>
    <div class="metric-card">
        <p class="metric-label">Active Subscriptions</p>
        <p class="metric-value">{{ dashboard.subscription_stats.active if dashboard.subscription_stats else 0 }}</p>
        <div class="flex gap-4 mt-2 text-sm">
            <span class="text-green-600">{{ dashboard.subscription_stats.new_this_month if dashboard.subscription_stats else 0 }} new</span>
            <span class="text-red-500">{{ dashboard.subscription_stats.churned_this_month if dashboard.subscription_stats else 0 }} churned</span>
        </div>
    </div>
    <div class="metric-card">
        <p class="metric-label">Average Revenue Per User</p>
        <p class="metric-value text-ng-green">₦{{ "{:,.0f}".format(dashboard.arpu if dashboard.arpu else 25000) }}</p>
        <p class="text-sm text-gray-500 mt-2">Per paying tenant</p>
    </div>
</div>

<!-- Subscription Breakdown -->
<div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
    <!-- By Tier -->
    <div class="metric-card">
        <div class="section-header">
            <h3 class="section-title">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"/></svg>
                Subscriptions by Tier
            </h3>
        </div>
        <div class="space-y-4">
            <!-- Enterprise -->
            <div class="p-4 bg-purple-50 rounded-xl">
                <div class="flex items-center justify-between mb-2">
                    <div class="flex items-center gap-3">
                        <span class="sku-badge enterprise">Enterprise</span>
                        <span class="text-sm text-gray-500">₦150,000/mo</span>
                    </div>
                    <div class="text-right">
                        <span class="font-semibold">{{ dashboard.subscription_stats.by_tier.enterprise if dashboard.subscription_stats else 0 }}</span>
                        <span class="text-gray-500 text-sm">tenants</span>
                    </div>
                </div>
                <div class="flex items-center justify-between text-sm">
                    <span class="text-gray-500">Revenue contribution</span>
                    <span class="font-medium text-purple-600">₦{{ "{:,.0f}".format((dashboard.subscription_stats.by_tier.enterprise if dashboard.subscription_stats else 0) * 150000) }}</span>
                </div>
            </div>
            
            <!-- Professional -->
            <div class="p-4 bg-blue-50 rounded-xl">
                <div class="flex items-center justify-between mb-2">
                    <div class="flex items-center gap-3">
                        <span class="sku-badge professional">Professional</span>
                        <span class="text-sm text-gray-500">₦50,000/mo</span>
                    </div>
                    <div class="text-right">
                        <span class="font-semibold">{{ dashboard.subscription_stats.by_tier.professional if dashboard.subscription_stats else 0 }}</span>
                        <span class="text-gray-500 text-sm">tenants</span>
                    </div>
                </div>
                <div class="flex items-center justify-between text-sm">
                    <span class="text-gray-500">Revenue contribution</span>
                    <span class="font-medium text-blue-600">₦{{ "{:,.0f}".format((dashboard.subscription_stats.by_tier.professional if dashboard.subscription_stats else 0) * 50000) }}</span>
                </div>
            </div>
            
            <!-- Core -->
            <div class="p-4 bg-green-50 rounded-xl">
                <div class="flex items-center justify-between mb-2">
                    <div class="flex items-center gap-3">
                        <span class="sku-badge core">Core</span>
                        <span class="text-sm text-gray-500">₦15,000/mo</span>
                    </div>
                    <div class="text-right">
                        <span class="font-semibold">{{ dashboard.subscription_stats.by_tier.core if dashboard.subscription_stats else 0 }}</span>
                        <span class="text-gray-500 text-sm">tenants</span>
                    </div>
                </div>
                <div class="flex items-center justify-between text-sm">
                    <span class="text-gray-500">Revenue contribution</span>
                    <span class="font-medium text-green-600">₦{{ "{:,.0f}".format((dashboard.subscription_stats.by_tier.core if dashboard.subscription_stats else 0) * 15000) }}</span>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Add-on Revenue -->
    <div class="metric-card">
        <div class="section-header">
            <h3 class="section-title">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"/></svg>
                Intelligence Add-on
            </h3>
            <span class="status-badge active">Popular</span>
        </div>
        <div class="space-y-4">
            <div class="text-center p-6 bg-purple-50 rounded-xl">
                <p class="text-4xl font-bold text-purple-600">{{ dashboard.intelligence_attach_rate if dashboard.intelligence_attach_rate else '24%' }}</p>
                <p class="text-sm text-gray-500 mt-1">Attach Rate</p>
            </div>
            <div class="grid grid-cols-2 gap-4">
                <div class="text-center p-4 bg-gray-50 rounded-xl">
                    <p class="text-2xl font-bold text-gray-900">{{ dashboard.intelligence_subscribers if dashboard.intelligence_subscribers else 0 }}</p>
                    <p class="text-xs text-gray-500 mt-1">Active Subscriptions</p>
                </div>
                <div class="text-center p-4 bg-gray-50 rounded-xl">
                    <p class="text-2xl font-bold text-ng-green">₦{{ "{:,.0f}".format((dashboard.intelligence_subscribers if dashboard.intelligence_subscribers else 0) * 25000) }}</p>
                    <p class="text-xs text-gray-500 mt-1">Monthly Add-on Revenue</p>
                </div>
            </div>
            <p class="text-sm text-gray-500 text-center">₦25,000/month per tenant</p>
        </div>
    </div>
</div>

<!-- Billing Table -->
<div class="data-grid">
    <div class="p-4 border-b border-gray-100">
        <div class="flex items-center justify-between">
            <h3 class="font-semibold text-gray-900 flex items-center gap-2">
                <svg class="w-5 h-5 text-ng-green" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01"/></svg>
                Recent Invoices
            </h3>
            <div class="flex items-center gap-2">
                <select class="px-3 py-1.5 border border-gray-200 rounded-lg text-sm">
                    <option>All Invoices</option>
                    <option>Paid</option>
                    <option>Pending</option>
                    <option>Overdue</option>
                </select>
                <button class="btn-secondary text-sm">Export</button>
            </div>
        </div>
    </div>
    <table>
        <thead>
            <tr>
                <th>Invoice ID</th>
                <th>Tenant</th>
                <th>Tier</th>
                <th>Amount</th>
                <th>Status</th>
                <th>Due Date</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for invoice in dashboard.recent_invoices if dashboard.recent_invoices %}
            <tr>
                <td class="font-mono text-sm">{{ invoice.id }}</td>
                <td>{{ invoice.tenant_name }}</td>
                <td><span class="sku-badge {{ invoice.tier }}">{{ invoice.tier.title() }}</span></td>
                <td class="font-medium">₦{{ "{:,.0f}".format(invoice.amount) }}</td>
                <td>
                    <span class="status-badge {% if invoice.status == 'paid' %}active{% elif invoice.status == 'pending' %}trial{% else %}suspended{% endif %}">
                        {{ invoice.status.title() }}
                    </span>
                </td>
                <td class="text-gray-500 text-sm">{{ invoice.due_date }}</td>
                <td>
                    <button class="p-1.5 text-gray-400 hover:text-ng-green hover:bg-ng-green-pale rounded-lg">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"/></svg>
                    </button>
                </td>
            </tr>
            {% else %}
            <tr>
                <td colspan="7" class="text-center py-8 text-gray-500">No invoices found</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<!-- Payment Provider Status -->
<div class="mt-6">
    <div class="metric-card">
        <div class="section-header">
            <h3 class="section-title">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z"/></svg>
                Payment Providers
            </h3>
        </div>
        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
            <div class="flex items-center justify-between p-4 bg-green-50 rounded-xl">
                <div class="flex items-center gap-3">
                    <div class="w-10 h-10 bg-white rounded-lg flex items-center justify-center shadow-sm">
                        <span class="font-bold text-green-600">P</span>
                    </div>
                    <div>
                        <p class="font-medium">Paystack</p>
                        <p class="text-xs text-gray-500">Primary</p>
                    </div>
                </div>
                <span class="health-indicator healthy"></span>
            </div>
            <div class="flex items-center justify-between p-4 bg-blue-50 rounded-xl">
                <div class="flex items-center gap-3">
                    <div class="w-10 h-10 bg-white rounded-lg flex items-center justify-center shadow-sm">
                        <span class="font-bold text-blue-600">F</span>
                    </div>
                    <div>
                        <p class="font-medium">Flutterwave</p>
                        <p class="text-xs text-gray-500">Backup</p>
                    </div>
                </div>
                <span class="health-indicator healthy"></span>
            </div>
            <div class="flex items-center justify-between p-4 bg-gray-50 rounded-xl">
                <div class="flex items-center gap-3">
                    <div class="w-10 h-10 bg-white rounded-lg flex items-center justify-center shadow-sm">
                        <span class="font-bold text-gray-600">B</span>
                    </div>
                    <div>
                        <p class="font-medium">Bank Transfer</p>
                        <p class="text-xs text-gray-500">Manual</p>
                    </div>
                </div>
                <span class="health-indicator healthy"></span>
            </div>
        </div>
    </div>
</div>
